main:
  params: [args]
  steps:
    - pickAPIcall:
        switch:
          - condition: ${args.method == 0}
            next: callGetAccountSub
          - condition: ${args.method == 1}
            next: callNotifyAccountSub
        next: returnError  
    - callGetAccountSub:
        call: getUserInfoSubprocess
        args:
          args: ${args}
        result: Res
        next: returnOutput
    - callNotifyAccountSub:
        call: notifyUserSubprocess
        args:
          inputs: ${args}
        result: Res
        next: returnOutput
    - returnOutput:
        return: ${Res}
    - returnError: 
        return: "Invalid Operation"

notifyUserSubprocess:
  params: [inputs]
  steps:
    - notifyAccount:
        call: http.request
        args:
          url: https://us-central1-jads-ada-2022-342407.cloudfunctions.net/auto_notifiy
          method: POST
          body:
            from: steven0201k@gmail.com
            to: ${inputs.to}
            subject: ${inputs.subject}
            message: ${inputs.message}
        result: notifyRes
        next: returnOutput
    - returnOutput:
        return: ${notifyRes}

getUserInfoSubprocess:
  params: [args]
  steps:
    - GetAccIDURL:
        assign:
          - GetAccURL: ${"http://35.224.127.81:5000/accounts/" + string(args.a_id)}
    - Checkaccount:
        call: http.get
        args:
          url: ${GetAccURL}
        result: GetAccRes
    - return_acc_info:
        return: ${GetAccRes}